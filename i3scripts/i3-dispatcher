#!/bin/bash
#
# i3-dispatcher
#

#
# Forward the command to a dedicated function.
#
forward ()
{
    export PATH=${HOME}/local/bin:${PATH}
    case "$1" in
	([a-z][0-9])
	    nohup i3-focus-app-by-alias focus "$1"
	    ;;
	([a-z][a-z])
	    nohup i3-focus-app-by-alias focus "$1"
            ;;
        (clip|edit)
            nohup i3-transcribe "${@}"
            ;;
        (start|stop)
            nohup i3-launcher "${@}"
            ;;
	(*)
	nomatchfound "$*"
	    ;;
    esac
}

# Error message handler.
nomatchfound ()
{
    # This message delivery is non-blocking.
    (echo "i3-dispatcher: No match found! \"$*\"" |
	 dmenu -b -fn "pango:DejaVu Sans 11") &
    sleep 7
    # This key event effects a timeout, but only if the user
    # hasn't dismissed the dmenu first. It isn't watertight.
    if [ "$(pgrep -c -af 'dmenu -b -fn pango:DejaVu Sans 11')" -eq 1 ]; then
	xdotool key --clearmodifiers  Escape
    fi
}

#
# Start here.
#
#

"$1" "$2" "${@:3}"

#
## Done.
#]
