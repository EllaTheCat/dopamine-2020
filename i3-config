# -*- Mode: Shell-script -*-
#
# i3 config file (v4).17.1.1 Xubuntu 20.04 LTS 01 May 2020
# Combines EllaTheCat dopamine with the de facto standard i3 bindings.
# "HJKL" replaces "JKL:" because "vi", "b" replaces "h" because similar.
#
# Please see http://i3wm.org/docs/userguide.html for a complete reference!

#
# IMPORTANT.
#
# You *must* run 'make' successfully before attempting reload or
# refresh.  Config changes trigger reload. Status changes trigger
# restart.  There are no bindings, using i3-msg in the terminal where
# yuo did 'make' is recommended.
#

#
# NON NEGOTIABLE.
#
# - Bindings and settings are defined such that  "first one wins".
# - A corollary is that essentials be defined as early as possible.
#

# Choose a terminal you can use to repair a broken configuration.
bindsym Mod4+Return exec xfce4-terminal

#

#
# CONSTANTS.
#

# Mod4 (Windows) key is the default, Mod1 (Alt) is the alternative.
# Setting $mod to Mod3 "disables" the classic bindings.
set $mod Mod4

# In default mode, this facilitates move and resize using the mouse
# without having to precisely position the mouse on window edges.
floating_modifier Mod4

set $default exec --no-startup-id ~/local/bin/i3-mode default
set $primary exec --no-startup-id ~/local/bin/i3-mode Primary
set $secondary exec --no-startup-id ~/local/bin/i3-mode Secondary

# Helpers. Embedding the path explicitly is belt and braces.
set $i3cmdprompt exec --no-startup-id ~/local/bin/i3-command-prompt
set $i3filewatcher exec_always --no-startup-id ~/local/bin/i3-file-watcher
set $i3mode exec --no-startup-id ~/local/bin/i3-mode
set $i3scratchpad exec --no-startup-id ~/local/bin/i3-scratchpad
set $i3listwindows exec --no-startup-id ~/local/bin/i3-list-windows

# Use 'xrandr' with no arguments to list monitor names and geometry.
# Assign outputs to monitors from left to right, repeat last assignment,
# thus a dual monitor config can refer to $lmon and $rmon.
set $lmon HDMI-2
set $cmon HDMI-1
set $rmon HDMI-1

## Type 'pactl list sinks' to list audio outputs.
set $analogaudiosink alsa_output.pci-0000_00_1b.0.analog-stereo
set $bluetoothaudiosink bluez_sink.00_01_01_00_12_CB
set $hdmiaudiosink alsa_output.pci-0000_00_03.0.hdmi-stereo
set $usbaudiosink alsa_output.usb-C-Media_Electronics_Inc._USB_Audio_Device-00.analog-stereo
# Type 'pactl list sources' to list audio inputs.
# Between 20.04 LTS and 16.04 LTS there are minor differences.
set $webcamaudiosource alsa_input.usb-Alcor_Micro__Corp._TeckNet-02.mono-fallback
set $analogaudiosource alsa_input.pci-0000_00_1b.0.analog-stereo
set $usbaudiosource alsa_input.usb-C-Media_Electronics_Inc._USB_Audio_Device-00.mono-fallback

# Font for i3-input.
set $i3inputfont "pango:DejaVu Sans 11"

# Refactoring the associated script(s) might require stubs.
set $stub nop

###INSERT_CFG00_HERE###

#
# BINDINGS
#

# Menu is a design decision please do not change.
# I have used 'xcape' to bind Super_L to Menu for the left hand.
# Pressing cycles through the three modes. Def->Pri->Sec->Def.
bindsym Menu $primary
bindsym Print $primary

# KP_Insert  is a design decision please do not change.
# Command prompt in one keypress.  Faciltates 3 digit commands.
bindsym KP_Insert $i3cmdprompt menu 4

###INSERT_CFG01_HERE###

###INSERT_CFG02_HERE###

#
# MODES
#

# Primary mode.
# Use this mode for window management, not settings.
mode "Primary" {

    # Protect the exit from this mode.
    # Using space is a design decision, please do not change.
    bindsym space $default

    # This is independent of the similarly named configuration setting.
    bindsym q $default, workspace back_and_forth

    # (W)orkspace.
    bindsym w  \
            $default, exec i3-input -f $i3inputfont  -l 2 \
            -P '(workspace): ' -F 'workspace "%s"'

    # (R)ename a workspace.
    bindsym r \
            $default, exec i3-input -f $i3inputfont -l 2 \
            -P '(rename this workspace to): ' \
            -F 'rename workspace to "%s"'

    # Launch a terminal. Including the preceding splits feels natural
    # to me. I urge you to try it.
    bindsym t $default, split h, exec xfce4-terminal
    bindsym y $default, split v, exec xfce4-terminal

    # Focus the workspace with the latest [u]rgency hint.
    bindsym u $default, [urgent=latest] focus

    # [I]nfo on keyboard bindings. Reserved.
    bindsym i nop

    # P for Parent. O for Offspring.
    bindsym o $default, focus child
    bindsym p $default, focus parent

    # Scratchpad for the pulseaudio sound settings.
    bindsym bracketleft $default,  [title="Volume Control"]  move scratchpad
    bindsym bracketright $default,  [title="Volume Control"]  scratchpad show

    # Command prompt. Thumb and middle finger of the left hand.
    bindsym Tab $default, $i3cmdprompt menu 4
    # The backslash to the left of Z on a UK keyboard US intl layout.
    bindcode 94 $default, $i3cmdprompt menu 4

    # Toggle a side-by-side pair to one-above-the-other.
    # A for Above.
    bindsym a $default, focus right, split v, focus left, move right, move up ;
    # Toggle a one-above-the-other pair to side-by-side.
    # S for Side by Side.
    bindsym s $default, focus down, split h, focus up, move down, move left;

    # Layouts.
    bindsym d $default, layout default
    bindsym e $default, layout tabbed

    # Enter [f]ullscreen mode for the focused container.
    bindsym f $default, fullscreen toggle
    bindsym g $default, fullscreen toggle global

    # Increase or decrease the height or width symmetrically.
    # I orient myself by how the border separating windows moves.
    # Consider swapping the HL or JK directions if not to your liking.
    bindsym h resize grow right 6 px or 1 ppt, resize grow left 6 px or 1 ppt
    bindsym j resize shrink down 6 px or 1 ppt, resize shrink up 6 px or 1 ppt
    bindsym k resize grow up 6 px or 1 ppt, resize grow down 6 px or 1 ppt
    bindsym l resize shrink left 6 px or 1 ppt, resize shrink right 6 px or 1 ppt

    # Toggle between being a tiled|floating window.
    # Toggle focus between tiled|floating windows.
    bindsym semicolon floating toggle
    bindsym apostrophe focus mode_toggle

    # When the phone rings, related images overlay both my monitors,
    # this dismisses them with one keypress.
    bindsym Return $default,\
            [workspace="phonecall1"] kill, \
            [workspace="phonecall2"] kill, \
            focus output $lmon, workspace prev_on_output, \
            focus output $cmon, workspace prev_on_output;

    # Move workspace to another output.
    bindsym z $default, move workspace to output $lmon
    bindsym x $default, move workspace to output $cmon
    bindsym c $default, move workspace to output $rmon

    # Split directions.
    bindsym v split v
    bindsym b split h

    # Place a unique two digit mark on the focused window's title bar.
    # [u] and [m] are already in use. The mark is a two digit [n]umber.
    # The prompt doesn't work because it forgets where the focus was.
    bindsym n $default, nop

    # (M)ove container to named workspace.
    bindsym m \
            $default, exec i3-input -f $i3inputfont  -l 2 \
            -P '(move container to workspace): ' \
            -F 'move container to workspace "%s"'

    # [D]menu showing window titles and their associated marks.
    # The use case is finding the title a mark is associated with.
    # Selecting an item visits the mark.
    bindsym comma $default, $i3listwindows menu column $lmon
    bindsym period $default, $i3listwindows menu column $cmon
    bindsym slash $default, $i3listwindows menu column $rmon

    # Pressing cycles through the three modes. Pri->Sec->Def->Pri.
    bindsym Menu $secondary
    bindsym Print $secondary
}

###INSERT_CFG05_HERE###

# The reload and refresh modes are for the sole use of the Makefile.
mode "reload" {
    bindsym space $default
 }
mode "restart" {
    bindsym space $default
 }

###INSERT_CFG07_HERE###

###INSERT_CFG08_HERE###

# A dark and translucent appearance for urxvt should it be used in
# config files or in scripts.
exec --no-startup-id /usr/bin/xrdb ${HOME}/urxvt.Xdefaults

# Additional Menu and Escape keys.
# It's OK to restart a small utllity like this when i3 is restarted.
exec  ~/local/bin/i3-keyboard xmodmapkeys
exec  ~/local/bin/i3-keyboard xcapekeys

# Command Interface.
# It's OK to restart this script when i3 is restarted.
exec --no-startup-id ~/local/bin/i3-file-watcher

#
# Done.
#
